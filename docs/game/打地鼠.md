---
icon: edit
date: 2023-12-15
category:
  - 小白的游戏历程
tag:
  - 《打地鼠》
sticky: true
lastUpdated: true
footer: 第一个游戏：《打地鼠》
order: 2
author: Kevin
---

# 第一个游戏：《打地鼠》

## 1. 创建项目

- 1. 打开 Unity Hub 软件，选择新建项目。
- 2. 项目名称命名为 WhackAMole。
- 3. 选择采用2D项目模板进行创建。
- 4. 左下角Project项目文件区，选择一个名为Assets的文件夹。
- 5. 将Playmaker的插件拖入这个文件夹中，然后进行import安装。
- 6. 在Playmaker的弹窗中选择install Playmaker，并且选择go ahead。
- 7. 然后我们就能在Assets文件夹中看到Playmaker的文件夹。

## 2. 创建场景

- 1. 在Assets文件夹上右键，选择Create创建，选择Scene场景，并且重命名场景叫做WhackAMole，并且拖拽到Sence里。
- 2. 在左侧Hierarchy场景区，选择WhackAMole场景，右键选择2D Object，选择Sprites，选择Square，并且重命名为Ground。
- 3. 注意，此时在中间的Game窗口中设置窗口大小为1024x768，然后才将这个Square放大到1027x768。
- 4. 接下来开始创建地洞，也是创建一个Square，并且重命名为Hole，然后再右侧Inspector的Sprite Renderer菜单中修改Color为黑色。
- 5. 每个地洞中都存在一只地鼠，暂时由文字代替，所以再Hole上右键选择3DObject，选择3D Text，并且重命名为Mole
  - 在Inspector的Text Mesh菜单中修改Font Size为300，
  - Text为地鼠，
  - Anchor为Middle center，
  - Alignment为Center，
  - 再到Transfrom中调节Scale缩放值都为0.01。
- 6. 我们一共需要9个这样的地洞和地鼠，所以我们需要将它们做成一个Perfeb。
- 7. 在Assets中新建一个文件夹起名为Perfebs，然后将Hole拖拽到这个Perfebs文件夹中，这样我们就创建好了一个perfeb。
- 8. 接下来我们将这个prefeb复制8份，并且分别命名为Hole01、Hole02、Hole03……Hole08。
- 9. 这个时候的地鼠是都显示出来的，我们需要隐藏掉它们，双击perfeb，点击Mole，在Inspector的Mole菜单中勾选Hide。
- 10. 在Sence文件夹中，双击WhackAMole，选择Save保存。
- 11. 在WhackAMole中右键创建一个GameObject，重命名为HoleManager，在Inspector中reset对象参数。
- 12. 将这9个Hole拖拽到HoleManager中，此时我们完成了打地鼠的场景创建。

## 3. 随机显示一个地鼠

### 3.1 循环获取地洞数组

- 1. 点击HoleManager，在Inspector中点击Add Component，选择Playmaker，此时会载入一个PlaymakerFSM模块。
- 2. PlaymakerFSM模块中的edit，会出现playmaker面板，并在里面编写地鼠的逻辑。
- 3. 要随机生成地鼠，主要分为三个步骤：  - 把所有的地洞放在一个数组里；
  - 随机生成一个数，这个数在0到8之间；
  - 把地鼠显示出来。
- 4. 首先，在playmaker面板中，点击New Variable，命名为HoleArray，并且选择Array类型，在Array Type中选择GameObject。
- 5. 选择State 1，并且在State菜单中重命名为获取子节点数量（父节点是HoleManager），空白处双击，搜索GetChildCount，并且点击Add。
- 6. 在GetChildCount中，GameObject选择User Owner（对象本身），点击Store Result（存储结果），新建一个变量ChildCount。
- 7. 在playmaker面板空白处右键新建一个state，起名为循环遍历。
- 8. 在获取子节点数量模块上右键，选择Add Transition，选择FINISHED，左键按住FINISHED拉出一个箭头指向循环遍历模块。
- 9. 双击循环遍历模块，在Actions中搜索loop，选择loop，Loops选择上面的存储子节点数量的ChildCount，Store Current Loop选择新建一个LoopIndex变量用来存储循环到第几个Hole的下标，Loop Event选择新建一个LoopEvent。
- 10. 右键点击循环遍历模块，选择Add Transition，选择LoopEvent。
- 11. 右键新增一个state，命名为遍历处理，左键按住循环遍历模块拖动箭头指向遍历处理模块，双击遍历处理模块，在Actions中搜索GetChildNum（获取当前子节点），GameObject选择UserOwner，Child Index选择LoopIndex，Store选择新建一个CurrentHole变量，再Actions中搜索Array Add，Array选择Holes，Value选择CurrentHole。
- 12. 右键遍历处理模块，选择Add Transition，选择FINISHED，指向遍历循环模块。
- 13. 遍历循环结束了，我们需要给循环遍历模块，选择Add Transition，选择选择FINISHED。
- 14. 新建一个state，再Actions中搜索Debug Log，改名为遍历完成，Text填写“遍历完成”，勾选Send To Unity Log。
- 15. 将遍历循环模块的箭头拖动到Debug Log模块上。

### 3.2 随机获取一个地洞，并且地洞中显示一个地鼠

- 1. 经历上一个步骤验证过后，我们将遍历完成模块更名为随机生成地鼠，双击空白处，在Actions中搜索Array Get Random，Array选择Holes，Store Value选择新建一个RandomHole变量。
- 2. 地洞和地鼠属于父子关系，双击空白处，在Actions中搜索Get Child，Game Object选择Specify Game Object再选择RandomHole，Child Name填写Mole，Store Result选择新建一个RandomMole变量。
- 3. 由于在创建场景的时候将地鼠隐藏了，我们需要激活它，在Actions中搜索Activate Game Object，Game Object选择Specify Game Object再选择RandomHole，Activate是默认勾选的，Recursive取消勾选。
- 4. 若是运行时，没有正常显示地洞，检查地洞和ground的层级。

### 3.3 1秒显示一个地鼠

- 1. 在随机生成地鼠模块中，双击空白处，在Actions中搜索Send Event，Event Target选择Self，Send Event选择新建一个事件命名为RepeatSelf，Delay选择1（每隔1秒重复一次），右键点击随机生成地鼠模块，选择RepeatSelf并将箭头指向自己。
- 2. 测试运行过程中，显示地鼠时快时慢，原因在于我们并没有对已经出现地鼠的地洞进行标记，所以我们需要进一步都地洞Perfeb对象进行操作。
- 3. 双击Hole这个Perfeb，在右侧菜单中点击Add Component，添加一个PlayMakerFSM，并且重命名为Hole，然后在变量菜单中，新建一个Boolean类型的变量命名为地鼠是否显示，用来保存地洞中地鼠的状态，地鼠默认状态是不显示的，所以创建第一个state是地鼠未显示，第二个state是地鼠正在显示，然后我们添加一个Event命名为显示地鼠，并且勾选全局变量，然后再地鼠未显示添加显示地鼠的Event，并且指向地鼠正在显示，在state地鼠正在显示State菜单中，找到并勾选Bool Value。
- 选中地鼠正在显示，双击空白处，搜索Activate Game Object，Game Object选择Specify Game Object并且将Mole拖进去，Activate勾选，Recursive取消勾选。
- 回到HoleManager,移除前面做的获取子节点state和Activate Game Object，然后我们要先判断随机获取的这个地洞是否已经显示过了，所以我们需要获得Boolean变量，双击空白处，搜索Get FSM Bool，并且移动到Array Get Random的下面，Game Object 还是 RandomHole，FSM Name起名叫Hole，Variable name选择输入地鼠是否显示，Store Value选择新建一个变量随机地洞中的地鼠是否显示，双击空白处，搜索选择Bool Test，Bool Variable选择随机地洞中的地鼠是否显示，Is True添加一个事件RepeatSelf（重新获取地洞）。
- 双击空白处，选择Send Event，Event Target选择Game Object，Game Object选择Specify Game Object选择RandomHole，Send Event选择显示地鼠

### 3.4 地鼠的消失和死亡

- 地鼠的消失与死亡，还是在Hole这个Perfebs中去实现
	- 创建一个地鼠消失的state
	- 创建一个地鼠定时消失的event，指向地鼠未显示state中
	- 创建一个地鼠在鼠标点击后消失的event，指向地鼠未显示state中

### 4.1 分数

- 显示分数的步骤：
	- 创建一个Score Text，显示分数
	- 在Score Text中新建一个分数变量
	- 地鼠死亡的同时发送一个加一分的全局事件
	- ScoreText 监听到加一分事件后分数变量进行+1操作
- 架构
	- 数据操控
		- 1. 接收命令
		- 2. 处理数据
		- 3. 发送事件
	- 数据模型
		- 1. 创建数据
		- 2. 数据的初始化