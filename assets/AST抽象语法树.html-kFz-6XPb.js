import{_ as o}from"./plugin-vue_export-helper-DlAUqK2U.js";import{r as c,c as l,o as i,a as s,e as p,b as a,d as t}from"./app-dMZrmJOA.js";const r="/assets/AST抽象语法树-编译器原理-DkIKQhn9.png",u={},k={href:"https://juejin.cn/post/7155151377013047304",target:"_blank",rel:"noopener noreferrer"},d={href:"https://babeljs.io/docs/",title:"Babel",target:"_blank",rel:"noopener noreferrer"},v={href:"https://astexplorer.net/",title:"在线 ast 转换器",target:"_blank",rel:"noopener noreferrer"};function m(b,n){const e=c("ExternalLinkIcon");return i(),l("div",null,[n[9]||(n[9]=s("h1",{id:"跟着大佬学前端之-ast-抽象语法树",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#跟着大佬学前端之-ast-抽象语法树","aria-hidden":"true"},"#"),a(" 跟着大佬学前端之 AST（抽象语法树）")],-1)),n[10]||(n[10]=s("h2",{id:"前端工程化基石-ast-抽象语法树-以及-ast-的广泛应用",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#前端工程化基石-ast-抽象语法树-以及-ast-的广泛应用","aria-hidden":"true"},"#"),a(" 前端工程化基石 -- AST（抽象语法树）以及 AST 的广泛应用")],-1)),s("p",null,[s("a",k,[n[0]||(n[0]=a("参考自掘金《前端工程化基石 -- AST（抽象语法树）以及 AST 的广泛应用》",-1)),t(e)])]),n[11]||(n[11]=p(`<p>在本文中我们将会深挖 AST（抽象语法树）以及基于 AST 衍生出来的一系列实际应用。<br> 读完本章你会收获什么：</p><ul><li>AST（抽象语法树） 到底是什么？</li><li>AST 基础：从零到一手撸一个功能完备的编译器</li><li>AST 基础：Babel 的设计理念</li><li>AST 的应用：手写 console 插件，再也不怕打开控制台满屏的 console 了 😭😭😭</li><li>AST 的应用： ES6 是如何转成 ES5 的？</li><li>AST 的应用：30 行代码依靠 AST 实现代码压缩</li><li>AST 的应用：40 行代码知晓 ESLint 的工作原理</li><li>AST 的应用：手写 按需加载插件 ，同事看了都说 666</li><li>AST 的应用：手写 Typescript 代码检测插件（fork-ts-checker-webpack-plugin），原来 TS 语法检测如此简单</li><li>其他延伸：结合 AST 手写监控系统中的日志上传插件</li><li>其他延伸：教你玩转 AST，最佳实践</li></ul><h2 id="ast-抽象语法树-到底是什么" tabindex="-1"><a class="header-anchor" href="#ast-抽象语法树-到底是什么" aria-hidden="true">#</a> AST（抽象语法树） 到底是什么？</h2><p>抽象语法树（Abstract Syntax Tree，AST）是源代码语法结构的一种抽象表示，它以树状的形式表现编程语言的语法结构，树上的每个节点都表示源代码中的一种结构。在代码语法的检查、代码风格的检查、代码的格式化、代码的高亮、代码错误提示、代码自动补全等等场景均有广泛的应用。</p><p>以前我们在做小学语文题时，经常会做到的一种题型就是在一句话中找出不恰当的部分，比如：&quot;你是猪，&quot;</p><p>解题方法通常是：</p><ul><li>第一步：找出语句中的主语、谓语、宾语。</li><li>第二步：找出语句中的形容词、动词、标点符号等进行分析。</li></ul><p>如果将其程序化，我们按照上面的方法可以先将其进行拆分成这样：</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token char">&#39;主语&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token char">&#39;你&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token char">&#39;谓语&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token char">&#39;是&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token char">&#39;宾语&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token char">&#39;猪&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token char">&#39;标点符号&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token char">&#39;，&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这一步骤中可以很快的发现第一个错误：在句末使用的是一个逗号 ❌，实际应该使用句号。</p><p>接着再对主语、谓语、宾语中的词语进行依次分析，将数据结构整理成这样：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;语句&quot;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;肯定陈述句&quot;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">declarations</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;声明&quot;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">person</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;你&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;animal&quot;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&quot;猪&quot;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在这个结构中我们发现：在一个肯定陈述句中，将一个人比作一个猪 🐷，显然不合适...❌，因此找出第二个错误。</p><p>在上面这个简单的例子中，其实和 AST 的生成和应用就颇为相似，<code>AST是源代码的抽象语法结构的树状表现形式，简单点就是一个深度嵌套对象，这个对象能够描述我们书写代码的所有信息</code>。</p><p>为了帮大家加深理解，接下来我将手牵手带大家撸一个小型的编译器。</p><h2 id="手写编译器" tabindex="-1"><a class="header-anchor" href="#手写编译器" aria-hidden="true">#</a> 手写编译器</h2><p>该小节分为两个部分：设计篇和原理篇。</p><p>设计篇侧重整体设计，原理篇则是手撕代码，侧重编码实现，在阅读过程中建议将重心放在设计篇，学习思想最重要。</p><h3 id="设计篇" tabindex="-1"><a class="header-anchor" href="#设计篇" aria-hidden="true">#</a> 设计篇</h3><h4 id="整体流程" tabindex="-1"><a class="header-anchor" href="#整体流程" aria-hidden="true">#</a> 整体流程</h4><p>一个完整的编译器整体执行过程可以分为三个步骤：</p><ol><li><p>Parsing(解析过程)：这个过程要经词法分析、语法分析、构建 AST（抽象语法树）一系列操作；</p></li><li><p>Transformation（转化过程）：这个过程就是将上一步解析后的内容，按照编译器指定的规则进行处理，形成一个新的表现形式；</p></li><li><p>Code Generation（代码生成）：将上一步处理好的内容转化为新的代码；</p></li></ol><p>如图所示，不喜欢看字的就看图：</p><figure><img src="`+r+`" alt="&#39;编译器原理&#39;" tabindex="0" loading="lazy"><figcaption>编译器原理</figcaption></figure><p>接下来，我们先看一个小 Demo，将 lisp 的函数调用编译成类似 C 的函数，如果你不熟悉也没关系，看完下面的代码相信大家能够快速的理解：</p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>LISP 代码： (add 2 (subtract 4 2))
C 代码： add(2, subtract(4, 2))
代码 释义： 2 + （ 4 - 2 ）
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="parsing-解析" tabindex="-1"><a class="header-anchor" href="#parsing-解析" aria-hidden="true">#</a> Parsing（解析）</h4><p>解析过程分为 2 个步骤：<code>词法分析</code>、<code>语法分析</code>。</p><p><strong>词法分析</strong> 是使用<code>tokenizer(分词器)</code>或者<code>lexer(词法分析器)</code>，将源码拆分成<code>tokens</code>，tokens 是一个放置对象的数组，其中的每一个对象都可以看做是一个单元（数字，标签，标点，操作符...）的描述信息。</p><p>结合最开始做的语文题目（<em>&quot;你是猪，&quot;</em>），我们照葫芦画瓢，对<code>(add 2 (subtract 4 2))</code> 进行词法分析后得到：</p><div class="language-c line-numbers-mode" data-ext="c"><pre class="language-c"><code><span class="token punctuation">[</span>
  <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token char">&#39;paren&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token char">&#39;(&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token char">&#39;name&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token char">&#39;add&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token char">&#39;number&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token char">&#39;2&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token char">&#39;paren&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token char">&#39;(&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token char">&#39;name&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token char">&#39;subtract&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token char">&#39;number&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token char">&#39;4&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token char">&#39;number&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token char">&#39;2&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token char">&#39;paren&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token char">&#39;)&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token char">&#39;paren&#39;</span><span class="token punctuation">,</span> value<span class="token operator">:</span> <span class="token char">&#39;)&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>像这样对中文语句进行了主谓宾的拆解得到了<code>tokens</code>，但这并不能帮助我们判断该条语句是否合法，还需要进行<strong>语法解析</strong>。</p><p><strong>语法解析</strong>则是将<code>tokens</code>重新整理成语法相互关联的表达形式 ，这种表达形式一般被称为<code>中间层或者AST（抽象语法树）</code>。</p><p>还是拿语文题目（&quot;<em>你是猪，</em>&quot;）来照葫芦画瓢，<code>(add 2 (subtract 4 2))</code> 进行语法解析后得到的 AST：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;Program&#39;</span><span class="token punctuation">,</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;CallExpression&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;add&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">params</span><span class="token operator">:</span>
      <span class="token punctuation">[</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;2&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;CallExpression&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;subtract&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;4&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;2&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="transfromer-转化" tabindex="-1"><a class="header-anchor" href="#transfromer-转化" aria-hidden="true">#</a> Transfromer（转化）</h4><p>这个过程主要是改写<code>AST（抽象语法树）</code>，<code>或者根据当前AST（抽象语法树）生成一个新的AST（抽象语法树）</code>，这个过程可以是相同语言，或者可以直接将 AST（抽象语法树）翻译为其他语言。</p><p>注意看上述生成的 AST（抽象语法树），有一些特殊的对象，都具有自己的类型描述，他们就是这个“树”上的节点，如下所示:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// 数字片段节点</span>
<span class="token punctuation">{</span>
   <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token punctuation">,</span>
   <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;2&#39;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// 调用语句节点</span>
 <span class="token punctuation">{</span>
   <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;CallExpression&#39;</span><span class="token punctuation">,</span>
   <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;subtract&#39;</span><span class="token punctuation">,</span>
   <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
     <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 数字片段节点</span>
     <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;4&#39;</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
     <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 数字片段节点</span>
     <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;2&#39;</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">]</span>
 <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在案例中我们是想将 lisp 语言转化为 C 语言，因此需要构建一个新的 AST（抽象语法树），这个创建的过程就需要遍历这个“树”的节点并读取其内容，由此引出 <strong>Traversal(遍历)</strong> 和 <strong>Visitors (访问器)</strong>。</p><p><strong>Traversal(遍历)</strong>：顾名思义这个过程就是，遍历这个 AST（抽象语法树）的所有节点，这个过程使用 深度优先原则，大概执行顺序如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> ast <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;Program&#39;</span><span class="token punctuation">,</span> <span class="token comment">// 进入Program - 最顶层开始</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// 进入 CallExpression (add)</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;CallExpression&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;add&#39;</span><span class="token punctuation">,</span>
      <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
          <span class="token comment">// 进入 NumberLiteral (2)</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;2&#39;</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 离开 NumberLiteral (2)</span>
        <span class="token punctuation">{</span>
          <span class="token comment">//进入 CallExpression (subtract)</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;CallExpression&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&#39;subtract&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span>
              <span class="token comment">//进入 NumberLiteral (4)</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;4&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//离开 NumberLiteral (4)</span>
            <span class="token punctuation">{</span>
              <span class="token comment">//进入 NumberLiteral (2)</span>
              <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token punctuation">,</span>
              <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;2&#39;</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//离开 NumberLiteral (2)</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//离开 CallExpression (subtract)</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">//离开 CallExpression (add)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//离开 Program</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Visitors (访问器)</strong>：访问器最基本的思想是创建一个“访问器”对象，这个对象可以处理不同类型的节点函数,如下所示:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> visitor <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">NumberLiteral</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 处理数字类型节点</span>
  <span class="token function">CallExpression</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 处理调用语句类型节点</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在遍历节点的时候，<strong>当 enter (进入)到该节点，我们会调用访问器，然后会调用针对于这个节点的相关函数</strong>，同时这个节点和其父节点作为参数传入。</p><p>同时在<strong>exit（离开）的时候我们也希望能够调用访问器</strong>，当 enter 一个节点的时候，最外层节点就相当于一个分支，他是一个节点，这个分支的内部依然存在若干节点，就像上边遍历的那样。</p><p>我们会按照<code>深度优先的原则</code>，依次遍历到这个分支的最内层，当达到最内层的时候，针对当前分支的访问就完成了，接着会依次 exit（退出）节点，这个过程是由内向外的。</p><p>为了能够处理到 enter 和 exit，访问器最终会做成这个样子</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> visitor <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">NumberLiteral</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token template-punctuation string">\`</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="code-generation-生成代码" tabindex="-1"><a class="header-anchor" href="#code-generation-生成代码" aria-hidden="true">#</a> Code Generation(生成代码)</h4><p>最后就是代码生成阶段了，<code>其实就是将生成的新AST树再转回代码的过程</code>。大部分的代码生成器主要过程是，不断的访问 Transformation 生成的 AST(抽象语法树)或者再结合 tokens，按照指定的规则，将“树”上的节点打印拼接最终还原为新的 code，自此编译器的执行过程就结束了。</p><h3 id="原理篇" tabindex="-1"><a class="header-anchor" href="#原理篇" aria-hidden="true">#</a> 原理篇</h3><p>接下来按照上述步骤，开始手写编译器。</p><h4 id="生成-tokens" tabindex="-1"><a class="header-anchor" href="#生成-tokens" aria-hidden="true">#</a> 生成 Tokens</h4><p>第一步: 将代码解析为 tokens。这个过程需要 tokenzier(分词器)函数，整体思路就是通过遍历字符串的方式，对每个字符按照一定的规则进行 switch case，最终生成 tokens 数组。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">tokenizer</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> current <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">//记录当前访问的位置</span>
  <span class="token keyword">let</span> tokens <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 最终生成的tokens</span>
  <span class="token comment">// 循环遍历input</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>current <span class="token operator">&lt;</span> input<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> char <span class="token operator">=</span> input<span class="token punctuation">[</span>current<span class="token punctuation">]</span>
    <span class="token comment">// 如果字符是开括号，我们把一个新的token放到tokens数组里，类型是\`paren\`</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>char <span class="token operator">===</span> <span class="token string">&#39;(&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;paren&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;(&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      current<span class="token operator">++</span>
      <span class="token keyword">continue</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 闭括号做同样的操作</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>char <span class="token operator">===</span> <span class="token string">&#39;)&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;paren&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token string">&#39;)&#39;</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      current<span class="token operator">++</span>
      <span class="token keyword">continue</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//空格检查，我们关心空格在分隔字符上是否存在，但是在token中他是无意义的</span>
    <span class="token keyword">let</span> <span class="token constant">WHITESPACE</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\s</span><span class="token regex-delimiter">/</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">WHITESPACE</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      current<span class="token operator">++</span>
      <span class="token keyword">continue</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//接下来检测数字，这里解释下 如果发现是数字我们如 add 22 33 这样</span>
    <span class="token comment">//我们是不希望被解析为2、2、3、3这样的，我们要遇到数字后继续向后匹配直到匹配失败</span>
    <span class="token comment">//这样我们就能截取到连续的数字了</span>
    <span class="token keyword">let</span> <span class="token constant">NUMBERS</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[0-9]</span><span class="token regex-delimiter">/</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NUMBERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant">NUMBERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value <span class="token operator">+=</span> char
        char <span class="token operator">=</span> input<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;number&#39;</span><span class="token punctuation">,</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">continue</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 接下来检测字符串,这里我们只检测双引号，和上述同理也是截取连续完整的字符串</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>char <span class="token operator">===</span> <span class="token string">&#39;&quot;&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>
      char <span class="token operator">=</span> input<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>char <span class="token operator">!==</span> <span class="token string">&#39;&quot;&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value <span class="token operator">+=</span> char
        char <span class="token operator">=</span> input<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      char <span class="token operator">=</span> input<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span>
      tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">,</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">continue</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 最后一个检测的是name 如add这样，也是一串连续的字符，但是他是没有“”的</span>
    <span class="token keyword">let</span> <span class="token constant">LETTERS</span> <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[a-z]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">LETTERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token string">&#39;&#39;</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token constant">LETTERS</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>char<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value <span class="token operator">+=</span> char
        char <span class="token operator">=</span> input<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
      tokens<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;name&#39;</span><span class="token punctuation">,</span> value <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">continue</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 容错处理，如果我们什么都没有匹配到，说明这个token不在我们的解析范围内</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&#39;I dont know what this character is: &#39;</span> <span class="token operator">+</span> char<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> tokens
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="生成-ast" tabindex="-1"><a class="header-anchor" href="#生成-ast" aria-hidden="true">#</a> 生成 AST</h4><p>第二步： 将生成好的<code>tokens</code>转化为<code>AST</code>。现在需要定义 parser 函数，接收上一步处理好的<code>tokens</code>：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">parser</span><span class="token punctuation">(</span><span class="token parameter">tokens</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> current <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">//访问tokens的下标</span>

  <span class="token comment">//walk函数辅助我们遍历整个tokens</span>
  <span class="token keyword">function</span> <span class="token function">walk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> token <span class="token operator">=</span> tokens<span class="token punctuation">[</span>current<span class="token punctuation">]</span>
    <span class="token comment">// 现在就是遍历出每一个token，根据其类型生成对应的节点</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;number&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      current<span class="token operator">++</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> token<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;string&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      current<span class="token operator">++</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;StringLiteral&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> token<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//这里处理调用语句</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;paren&#39;</span> <span class="token operator">&amp;&amp;</span> token<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">&#39;(&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      token <span class="token operator">=</span> tokens<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span>
      <span class="token comment">//这里以一个例子解释(add 2 3) 这样的代码 &quot;(&quot; 就是 paren token ，而接下来的node其实就是那个 name 类型的token &quot;add&quot;</span>
      <span class="token keyword">let</span> node <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;CallExpression&#39;</span><span class="token punctuation">,</span>
        <span class="token literal-property property">value</span><span class="token operator">:</span> token<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token literal-property property">params</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
      <span class="token comment">//获取name后我们需要继续获取接下来调用语句中的参数，直到我们遇到了&quot;)&quot;,这里会存在嵌套的现象如下</span>
      <span class="token comment">// (add 2 (subtract 4 2))</span>
      <span class="token comment">/*
        [                                        
          { type: &#39;paren&#39;, value: &#39;(&#39; },       
          { type: &#39;name&#39;, value: &#39;add&#39; },      
          { type: &#39;number&#39;, value: &#39;2&#39; },      
          { type: &#39;paren&#39;, value: &#39;(&#39; },       
          { type: &#39;name&#39;, value: &#39;subtract&#39; }, 
          { type: &#39;number&#39;, value: &#39;4&#39; },      
          { type: &#39;number&#39;, value: &#39;2&#39; },      
          { type: &#39;paren&#39;, value: &#39;)&#39; },       
          { type: &#39;paren&#39;, value: &#39;)&#39; },       
        ]
      */</span>
      token <span class="token operator">=</span> tokens<span class="token punctuation">[</span><span class="token operator">++</span>current<span class="token punctuation">]</span>
      <span class="token comment">//这里我们通过递归调用不断的读取参数</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span>type <span class="token operator">!==</span> <span class="token string">&#39;paren&#39;</span> <span class="token operator">||</span> <span class="token punctuation">(</span>token<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">&#39;paren&#39;</span> <span class="token operator">&amp;&amp;</span> token<span class="token punctuation">.</span>value <span class="token operator">!==</span> <span class="token string">&#39;)&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        node<span class="token punctuation">.</span>params<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">walk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        token <span class="token operator">=</span> tokens<span class="token punctuation">[</span>current<span class="token punctuation">]</span> <span class="token comment">//因为参数的if判断里会让 current++ 实际上就是持续向后遍历了tokens,然后将参数推入params</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 当while中断后就说明参数读取完了，现在下一个应该是&quot;)&quot;，所以我们++越过</span>
      current<span class="token operator">++</span>
      <span class="token keyword">return</span> node <span class="token comment">// 最终将CallExpression节点返回了</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//当然这里做了容错处理，如果没有匹配到预计的类型，就说明出现了，parse无法识别的token</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 现在我们创建AST，树的最根层就是Program</span>
  <span class="token keyword">let</span> ast <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;Program&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//然后我们通过调用walk遍历tokens将tokens内的对象，转化为AST的节点，完成AST的构建</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>current <span class="token operator">&lt;</span> tokens<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ast<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">walk</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> ast
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="遍历和访问生成好的-ast" tabindex="-1"><a class="header-anchor" href="#遍历和访问生成好的-ast" aria-hidden="true">#</a> 遍历和访问生成好的 AST</h4><p>现在已经有 AST 了，然后我们希望能够通过访问器访问不同的节点，当遇到不同的节点的时候，调用访问器的不同函数，大致设计成这样：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//  traverse(ast,visitor) 迭代器(抽象语法树，访问器)</span>
<span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">Program</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">CallExpression</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">NumberLiteral</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来实现<code>traverser</code>函数：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">traverser</span><span class="token punctuation">(</span><span class="token parameter">ast<span class="token punctuation">,</span> visitor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//遍历数组，在遍历数组的同时会调用traverseNode来遍历节点</span>
  <span class="token keyword">function</span> <span class="token function">traverseArray</span><span class="token punctuation">(</span><span class="token parameter">array<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    array<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">traverseNode</span><span class="token punctuation">(</span>child<span class="token punctuation">,</span> parent<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">traverseNode</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 判断访问器中是否有合适处理该节点的函数</span>
    <span class="token keyword">let</span> methods <span class="token operator">=</span> visitor<span class="token punctuation">[</span>node<span class="token punctuation">.</span>type<span class="token punctuation">]</span>
    <span class="token comment">// 如果有就执行enter函数，因为此时已经进入这个节点了</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>methods <span class="token operator">&amp;&amp;</span> methods<span class="token punctuation">.</span>enter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      methods<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> parent<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//接下来就根据node节点类型来处理了</span>
    <span class="token keyword">switch</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> <span class="token string">&#39;Program&#39;</span><span class="token operator">:</span>
        <span class="token function">traverseArray</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>body<span class="token punctuation">,</span> node<span class="token punctuation">)</span> <span class="token comment">//如果你是ast的根部，就相当于树根，body中的每一项都是一个分支</span>
        <span class="token keyword">break</span>
      <span class="token keyword">case</span> <span class="token string">&#39;CallExpression&#39;</span><span class="token operator">:</span>
        <span class="token function">traverseArray</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>params<span class="token punctuation">,</span> node<span class="token punctuation">)</span> <span class="token comment">//这个和Program一样处理，但是这里是为了遍历params,上面是为了遍历分支</span>
        <span class="token keyword">break</span>
      <span class="token comment">// 字符串和数字没有子节点需要访问直接跳过</span>
      <span class="token keyword">case</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token operator">:</span>
      <span class="token keyword">case</span> <span class="token string">&#39;StringLiteral&#39;</span><span class="token operator">:</span>
        <span class="token keyword">break</span>
      <span class="token comment">// 最后容错处理</span>
      <span class="token keyword">default</span><span class="token operator">:</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 当执行到这里时，说明该节点（分支）已经遍历到尽头了，执行exit</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>methods <span class="token operator">&amp;&amp;</span> methods<span class="token punctuation">.</span>exit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      methods<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span>node<span class="token punctuation">,</span> parent<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//我们从ast开始进行节点遍历，因为ast没有父节点所以传入null</span>
  <span class="token function">traverseNode</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="transformer-转化" tabindex="-1"><a class="header-anchor" href="#transformer-转化" aria-hidden="true">#</a> Transformer 转化</h4><p>现在已经生成好 AST 了。在这一步需要使用到转换器，帮助我们将刚才生成的 AST 转化为新的 AST。<code>在转化之前，必须要明确转化后的AST长什么样</code>，记得之前的案例：</p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>LISP 代码 (add 2 (subtract 4 2))
C 代码 add(2, subtract(4, 2))
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>将原来的 AST 转化为目标 AST，数据结构如下：</p><div class="language-css line-numbers-mode" data-ext="css"><pre class="language-css"><code><span class="token selector">*   Original AST                     |   Transformed AST
* ----------------------------------------------------------------------------
*</span>   <span class="token punctuation">{</span>                                <span class="token selector">|</span>   <span class="token punctuation">{</span>
<span class="token selector">*     type: &#39;Program&#39;,               |     type: &#39;Program&#39;,
*     body: [</span><span class="token punctuation">{</span>                       <span class="token selector">|     body: [</span><span class="token punctuation">{</span>
<span class="token selector">*       type: &#39;CallExpression&#39;,      |       type: &#39;ExpressionStatement&#39;,
*       name: &#39;add&#39;,                 |       expression:</span> <span class="token punctuation">{</span>
<span class="token selector">*       params: [</span><span class="token punctuation">{</span>                   <span class="token selector">|         type: &#39;CallExpression&#39;,
*         type: &#39;NumberLiteral&#39;,     |         callee:</span> <span class="token punctuation">{</span>
*         <span class="token property">value</span><span class="token punctuation">:</span> <span class="token string">&#39;2&#39;</span>                 |           <span class="token property">type</span><span class="token punctuation">:</span> <span class="token string">&#39;Identifier&#39;</span><span class="token punctuation">,</span>
*       <span class="token punctuation">}</span><span class="token selector">,</span> <span class="token punctuation">{</span>                         |           <span class="token property">name</span><span class="token punctuation">:</span> <span class="token string">&#39;add&#39;</span>
*         <span class="token property">type</span><span class="token punctuation">:</span> <span class="token string">&#39;CallExpression&#39;</span><span class="token punctuation">,</span>    |         <span class="token punctuation">}</span><span class="token selector">,
*         name: &#39;subtract&#39;,          |         arguments: [</span><span class="token punctuation">{</span>
<span class="token selector">*         params: [</span><span class="token punctuation">{</span>                 |           <span class="token property">type</span><span class="token punctuation">:</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token punctuation">,</span>
*           <span class="token property">type</span><span class="token punctuation">:</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token punctuation">,</span>   |           <span class="token property">value</span><span class="token punctuation">:</span> <span class="token string">&#39;2&#39;</span>
*           <span class="token property">value</span><span class="token punctuation">:</span> <span class="token string">&#39;4&#39;</span>               |         <span class="token punctuation">}</span><span class="token selector">,</span> <span class="token punctuation">{</span>
*         <span class="token punctuation">}</span><span class="token selector">,</span> <span class="token punctuation">{</span>                       <span class="token selector">|           type: &#39;CallExpression&#39;,
*           type: &#39;NumberLiteral&#39;,   |           callee:</span> <span class="token punctuation">{</span>
*           <span class="token property">value</span><span class="token punctuation">:</span> <span class="token string">&#39;2&#39;</span>               |             <span class="token property">type</span><span class="token punctuation">:</span> <span class="token string">&#39;Identifier&#39;</span><span class="token punctuation">,</span>
*         <span class="token punctuation">}</span>]                         |             <span class="token property">name</span><span class="token punctuation">:</span> <span class="token string">&#39;subtract&#39;</span>
*       <span class="token punctuation">}</span>]                           |           <span class="token punctuation">}</span><span class="token punctuation">,</span>
*     <span class="token punctuation">}</span><span class="token selector">]                             |           arguments: [</span><span class="token punctuation">{</span>
*   <span class="token punctuation">}</span>                                |             <span class="token property">type</span><span class="token punctuation">:</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token punctuation">,</span>
*                                    |             <span class="token property">value</span><span class="token punctuation">:</span> <span class="token string">&#39;4&#39;</span>
* ---------------------------------- |           <span class="token punctuation">}</span><span class="token selector">,</span> <span class="token punctuation">{</span>
*                                    |             <span class="token property">type</span><span class="token punctuation">:</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token punctuation">,</span>
*                                    |             <span class="token property">value</span><span class="token punctuation">:</span> <span class="token string">&#39;2&#39;</span>
*                                    |           <span class="token punctuation">}</span>]
*                                    |         <span class="token punctuation">}</span>
*                                    |       <span class="token punctuation">}</span>
*                                    |     <span class="token punctuation">}</span>]
*                                    |   <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>具体代码实现：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">transformer</span><span class="token punctuation">(</span><span class="token parameter">ast</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 将要被返回的新的AST</span>
  <span class="token keyword">let</span> newAst <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;Program&#39;</span><span class="token punctuation">,</span>
    <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 这里相当于将在旧的AST上创建一个_content,这个属性就是新AST的body，因为是引用，所以后面可以直接操作就的AST</span>
  ast<span class="token punctuation">.</span>_context <span class="token operator">=</span> newAst<span class="token punctuation">.</span>body
  <span class="token comment">// 用之前创建的访问器来访问这个AST的所有节点</span>
  <span class="token function">traverser</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// 针对于数字片段的处理</span>
    <span class="token literal-property property">NumberLiteral</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 创建一个新的节点，其实就是创建新AST的节点，这个新节点存在于父节点的body中</span>
        parent<span class="token punctuation">.</span>_context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> node<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 针对于文字片段的处理</span>
    <span class="token literal-property property">StringLiteral</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        parent<span class="token punctuation">.</span>_context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;StringLiteral&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">value</span><span class="token operator">:</span> node<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// 对调用语句的处理</span>
    <span class="token literal-property property">CallExpression</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token function">enter</span><span class="token punctuation">(</span><span class="token parameter">node<span class="token punctuation">,</span> parent</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 在新的AST中如果是调用语句，type是\`CallExpression\`，同时他还有一个\`Identifier\`，来标识操作</span>
        <span class="token keyword">let</span> expression <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;CallExpression&#39;</span><span class="token punctuation">,</span>
          <span class="token literal-property property">callee</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;Identifier&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> node<span class="token punctuation">.</span>value<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token literal-property property">arguments</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 在原来的节点上再创建一个新的属性，用于存放参数 这样当子节点修改_context时，会同步到expression.arguments中，这里用的是同一个内存地址</span>
        node<span class="token punctuation">.</span>_context <span class="token operator">=</span> expression<span class="token punctuation">.</span>arguments
        <span class="token comment">// 这里需要判断父节点是否是调用语句，如果不是，那么就使用\`ExpressionStatement\`将\`CallExpression\`包裹，因为js中顶层的\`CallExpression\`是有效语句</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">.</span>type <span class="token operator">!==</span> <span class="token string">&#39;CallExpression&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          expression <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&#39;ExpressionStatement&#39;</span><span class="token punctuation">,</span>
            <span class="token literal-property property">expression</span><span class="token operator">:</span> expression<span class="token punctuation">,</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        parent<span class="token punctuation">.</span>_context<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> newAst
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="新代码生成" tabindex="-1"><a class="header-anchor" href="#新代码生成" aria-hidden="true">#</a> 新代码生成</h4><p>最后一步： 新代码生成。<code>到这一步就是用新的AST，遍历其每一个节点，根据指定规则生成最终新的代码</code>。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">codeGenerator</span><span class="token punctuation">(</span><span class="token parameter">node</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 我们以节点的种类拆解(语法树)</span>
  <span class="token keyword">switch</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>type<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果是Progame,那么就是AST的最根部了，他的body中的每一项就是一个分支，我们需要将每一个分支都放入代码生成器中</span>
    <span class="token keyword">case</span> <span class="token string">&#39;Program&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> node<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>codeGenerator<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;\\n&#39;</span><span class="token punctuation">)</span>
    <span class="token comment">// 如果是声明语句注意看新的AST结构，那么在声明语句中expression，就是声明的标示，我们以他为参数再次调用codeGenerator</span>
    <span class="token keyword">case</span> <span class="token string">&#39;ExpressionStatement&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token function">codeGenerator</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>expression<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;;&#39;</span>
    <span class="token comment">// 如果是调用语句，我们需要打印出调用者的名字加括号，中间放置参数如生成这样&quot;add(2,2)&quot;,</span>
    <span class="token keyword">case</span> <span class="token string">&#39;CallExpression&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token function">codeGenerator</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>callee<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;(&#39;</span> <span class="token operator">+</span> node<span class="token punctuation">.</span>arguments<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>codeGenerator<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&#39;, &#39;</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&#39;)&#39;</span>

    <span class="token comment">// 如果是识别就直接返回值 如： (add 2 2),在新AST中 add就是那个identifier节点</span>
    <span class="token keyword">case</span> <span class="token string">&#39;Identifier&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> node<span class="token punctuation">.</span>name
    <span class="token comment">// 如果是数字就直接返回值</span>
    <span class="token keyword">case</span> <span class="token string">&#39;NumberLiteral&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> node<span class="token punctuation">.</span>value
    <span class="token comment">// 如果是文本就给值加个双引号</span>
    <span class="token keyword">case</span> <span class="token string">&#39;StringLiteral&#39;</span><span class="token operator">:</span>
      <span class="token keyword">return</span> <span class="token string">&#39;&quot;&#39;</span> <span class="token operator">+</span> node<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">&#39;&quot;&#39;</span>
    <span class="token comment">// 容错处理</span>
    <span class="token keyword">default</span><span class="token operator">:</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>type<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最终按照上面的步骤<code>实现compiler完成这个微型编译器</code>,注意这个过程的顺序。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">compiler</span><span class="token punctuation">(</span><span class="token parameter">input</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> tokens <span class="token operator">=</span> <span class="token function">tokenizer</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span> <span class="token comment">//生成tokens</span>
  <span class="token keyword">let</span> ast <span class="token operator">=</span> <span class="token function">parser</span><span class="token punctuation">(</span>tokens<span class="token punctuation">)</span> <span class="token comment">//生成ast</span>
  <span class="token keyword">let</span> newAst <span class="token operator">=</span> <span class="token function">transformer</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span> <span class="token comment">//拿到新的ast</span>
  <span class="token keyword">let</span> output <span class="token operator">=</span> <span class="token function">codeGenerator</span><span class="token punctuation">(</span>newAst<span class="token punctuation">)</span> <span class="token comment">//生成新代码</span>
  <span class="token keyword">return</span> output
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>代码演示:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token string">&#39;(update 4 (ChatGPT 23 2 17 (English 12 25)))&#39;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">compiler</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果:</p><div class="language-cmd line-numbers-mode" data-ext="cmd"><pre class="language-cmd"><code>C:\\Users\\admin\\Desktop\\test&gt;node ast.js
update(4, ChatGPT(23, 2, 17, English(12, 25)));
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="小结" tabindex="-1"><a class="header-anchor" href="#小结" aria-hidden="true">#</a> 小结</h4><p>通过运行以上代码，我们可以充分了解到代码编译器从词法解析拆解源代码，到语法解析生成 AST 抽象语法树，再到 AST 抽象语法树校验分析代码，再转换成新的 AST，最终生成新的代码的过程，以及编译器原理的代码设计思想。</p><h2 id="ast-的广泛应用" tabindex="-1"><a class="header-anchor" href="#ast-的广泛应用" aria-hidden="true">#</a> AST 的广泛应用</h2>`,83)),s("p",null,[n[2]||(n[2]=a("在讲 AST 的广泛应用之前，我们先来了解一下 ",-1)),s("a",d,[n[1]||(n[1]=a("Babel",-1)),t(e)]),n[3]||(n[3]=a(" 是什么？以免一部分同学不熟悉，影响后面的学习。",-1))]),n[12]||(n[12]=p(`<p><code>Babel</code> 其实就是一个最常用的 Javascript 编译器，它能够转译 <code>ECMAScript 2015+</code> 的代码，使它在旧的浏览器或者环境中也能够运行，工作过程分为三个部分（其实就跟我们上面手写的一样，相信大家现在肯定倍感亲切）：</p><ul><li>Parse(解析) 将源代码转换成抽象语法树，树上有很多的 <code>estree</code> 节点</li><li>Transform(转换) 对抽象语法树进行转换</li><li>Generate(代码生成) 将上一步经过转换过的抽象语法树生成新的代码</li></ul><p>当然我们现在不用从零开始手写了，可以借助于 babel 插件：</p><p>@babel/parser 可以把源码转换成 AST<br> @babel/traverse 用于对 AST 的遍历，维护了整棵树的状态，并且负责替换、移除和添加节点<br> @babel/generate 可以把 AST 生成源码，同时生成 sourcemap<br> @babel/types 用于 AST 节点的 Lodash 式工具库, 它包含了构造、验证以及变换 AST 节点的方法，对编写处理 AST 逻辑非常有用<br> @babel/core Babel 的编译器，核心 API 都在这里面，比如常见的 transform、parse，并实现了插件功能<br> 先安装：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># 里面就包含了@babel/parser、@babel/traverse、@babel/generate、@babel/types等</span>
<span class="token function">yarn</span> <span class="token function">add</span> @babel/core <span class="token parameter variable">-D</span>

或者

<span class="token function">npm</span> <span class="token function">install</span> --save-dev @babel/core
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="小试牛刀-使用-babel-修改函数名" tabindex="-1"><a class="header-anchor" href="#小试牛刀-使用-babel-修改函数名" aria-hidden="true">#</a> 小试牛刀：使用 Babel 修改函数名</h3><p>上面铺垫了这么多，现在开始进入实战演习。</p><p>要求：借助 Babel 给函数重命名。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">//源代码</span>
<span class="token keyword">const</span> <span class="token function-variable function">hello</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">//需要修改为：</span>
<span class="token keyword">const</span> <span class="token function-variable function">world</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>根据前面学过的知识点，我们先来整理下思路：</p>`,10)),s("p",null,[n[5]||(n[5]=p("先将源代码转化成 <code>AST</code><br> 遍历 <code>AST</code> 上的节点，找到 <code>hello</code> 函数名节点并修改<br> 将转换过的 <code>AST</code> 再生成 <code>JS</code> 代码<br> 将源代码拷贝到 ",16)),s("a",v,[n[4]||(n[4]=a("在线 ast 转换器",-1)),t(e)]),n[6]||(n[6]=a(" 中，查看 ",-1)),n[7]||(n[7]=s("code",null,"hello",-1)),n[8]||(n[8]=a(" 函数名节点：",-1))]),n[13]||(n[13]=p(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>Program  <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Program&quot;</span>
  <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">22</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span>  <span class="token punctuation">[</span>
    VariableDeclaration  <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclaration&quot;</span>
      <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">0</span>
      <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">22</span>
      <span class="token literal-property property">declarations</span><span class="token operator">:</span>  <span class="token punctuation">[</span>
        VariableDeclarator  <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclarator&quot;</span>
        <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">6</span>
        <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">22</span>
        <span class="token literal-property property">id</span><span class="token operator">:</span> Identifier  <span class="token punctuation">{</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span>
            <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">6</span>
            <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">11</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;hello&quot;</span> <span class="token comment">// ←函数名称</span>
        <span class="token punctuation">}</span>
        <span class="token literal-property property">init</span><span class="token operator">:</span> ArrowFunctionExpression <span class="token punctuation">{</span>type<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> id<span class="token punctuation">,</span> expression<span class="token punctuation">,</span> <span class="token operator">...</span> <span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span>
      <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;const&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
  <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接下来再看看目标函数的 AST，和原函数的 AST 做个比较：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>Program  <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Program&quot;</span>
  <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">0</span>
  <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">22</span>
  <span class="token literal-property property">body</span><span class="token operator">:</span>  <span class="token punctuation">[</span>
    VariableDeclaration  <span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclaration&quot;</span>
    <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">0</span>
    <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">22</span>
    <span class="token literal-property property">declarations</span><span class="token operator">:</span>  <span class="token punctuation">[</span>
      VariableDeclarator  <span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;VariableDeclarator&quot;</span>
      <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">6</span>
      <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">22</span>
      <span class="token literal-property property">id</span><span class="token operator">:</span> Identifier  <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">&quot;Identifier&quot;</span>
        <span class="token literal-property property">start</span><span class="token operator">:</span> <span class="token number">6</span>
        <span class="token literal-property property">end</span><span class="token operator">:</span> <span class="token number">11</span>
        <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">&quot;world&quot;</span> <span class="token comment">// ←函数名称</span>
      <span class="token punctuation">}</span>
      <span class="token literal-property property">init</span><span class="token operator">:</span> ArrowFunctionExpression <span class="token punctuation">{</span>type<span class="token punctuation">,</span> start<span class="token punctuation">,</span> end<span class="token punctuation">,</span> id<span class="token punctuation">,</span> expression<span class="token punctuation">,</span> <span class="token operator">...</span> <span class="token operator">+</span><span class="token number">4</span><span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
    <span class="token literal-property property">kind</span><span class="token operator">:</span> <span class="token string">&quot;const&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
  <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">&quot;module&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>现在我们已经有了思路：只需要将该节点的 name 字段修改即可。</p><p>该例子比较简单，直接上代码：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> parser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/parser&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/traverse&#39;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> generator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;@babel/generator&#39;</span><span class="token punctuation">)</span>

<span class="token comment">// 源代码</span>
<span class="token keyword">const</span> code <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">
const hello = () =&gt; {};
</span><span class="token template-punctuation string">\`</span></span>

<span class="token comment">// 1. 源代码解析成 ast</span>
<span class="token keyword">const</span> ast <span class="token operator">=</span> parser<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span>

<span class="token comment">// 2. 转换</span>
<span class="token keyword">const</span> visitor <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// traverse 会遍历树节点，只要节点的 type 在 visitor 对象中出现，变化调用该方法</span>
  <span class="token function">Identifier</span><span class="token punctuation">(</span><span class="token parameter">path</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> node <span class="token punctuation">}</span> <span class="token operator">=</span> path <span class="token comment">//从path中解析出当前 AST 节点</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>node<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">&#39;hello&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      node<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">&#39;world&#39;</span> <span class="token comment">//找到hello的节点，替换成world</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
traverse<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> visitor<span class="token punctuation">)</span>

<span class="token comment">// 3. 生成</span>
<span class="token keyword">const</span> result <span class="token operator">=</span> generator<span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>code<span class="token punctuation">)</span> <span class="token comment">//const world = () =&gt; {};</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,6))])}const h=o(u,[["render",m],["__file","AST抽象语法树.html.vue"]]);export{h as default};
