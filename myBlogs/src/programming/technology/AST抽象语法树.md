---
icon: edit
date: 2022-01-01
category:
  - Programing
tag:
  - AST
  - JavaScript
---

# è·Ÿç€å¤§ä½¬å­¦å‰ç«¯ä¹‹ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰

## å‰ç«¯å·¥ç¨‹åŒ–åŸºçŸ³ -- ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ä»¥åŠ AST çš„å¹¿æ³›åº”ç”¨

[å‚è€ƒè‡ªæ˜é‡‘ã€Šå‰ç«¯å·¥ç¨‹åŒ–åŸºçŸ³ -- ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ä»¥åŠ AST çš„å¹¿æ³›åº”ç”¨ã€‹](https://juejin.cn/post/7155151377013047304)

åœ¨æœ¬æ–‡ä¸­æˆ‘ä»¬å°†ä¼šæ·±æŒ– ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ä»¥åŠåŸºäº AST è¡ç”Ÿå‡ºæ¥çš„ä¸€ç³»åˆ—å®é™…åº”ç”¨ã€‚
è¯»å®Œæœ¬ç« ä½ ä¼šæ”¶è·ä»€ä¹ˆï¼š

- ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ
- AST åŸºç¡€ï¼šä»é›¶åˆ°ä¸€æ‰‹æ’¸ä¸€ä¸ªåŠŸèƒ½å®Œå¤‡çš„ç¼–è¯‘å™¨
- AST åŸºç¡€ï¼šBabel çš„è®¾è®¡ç†å¿µ
- AST çš„åº”ç”¨ï¼šæ‰‹å†™ console æ’ä»¶ï¼Œå†ä¹Ÿä¸æ€•æ‰“å¼€æ§åˆ¶å°æ»¡å±çš„ console äº† ğŸ˜­ğŸ˜­ğŸ˜­
- AST çš„åº”ç”¨ï¼š ES6 æ˜¯å¦‚ä½•è½¬æˆ ES5 çš„ï¼Ÿ
- AST çš„åº”ç”¨ï¼š30 è¡Œä»£ç ä¾é  AST å®ç°ä»£ç å‹ç¼©
- AST çš„åº”ç”¨ï¼š40 è¡Œä»£ç çŸ¥æ™“ ESLint çš„å·¥ä½œåŸç†
- AST çš„åº”ç”¨ï¼šæ‰‹å†™ æŒ‰éœ€åŠ è½½æ’ä»¶ ï¼ŒåŒäº‹çœ‹äº†éƒ½è¯´ 666
- AST çš„åº”ç”¨ï¼šæ‰‹å†™ Typescript ä»£ç æ£€æµ‹æ’ä»¶ï¼ˆfork-ts-checker-webpack-pluginï¼‰ï¼ŒåŸæ¥ TS è¯­æ³•æ£€æµ‹å¦‚æ­¤ç®€å•
- å…¶ä»–å»¶ä¼¸ï¼šç»“åˆ AST æ‰‹å†™ç›‘æ§ç³»ç»Ÿä¸­çš„æ—¥å¿—ä¸Šä¼ æ’ä»¶
- å…¶ä»–å»¶ä¼¸ï¼šæ•™ä½ ç©è½¬ ASTï¼Œæœ€ä½³å®è·µ

## ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ

### AST æ˜¯ä»€ä¹ˆï¼Ÿ

æŠ½è±¡è¯­æ³•æ ‘ (Abstract Syntax Tree)ï¼Œç®€ç§° ASTï¼Œå®ƒæ˜¯æºä»£ç è¯­æ³•ç»“æ„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤ºã€‚å®ƒä»¥æ ‘çŠ¶çš„å½¢å¼è¡¨ç°ç¼–ç¨‹è¯­è¨€çš„è¯­æ³•ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„ã€‚

### AST æœ‰ä»€ä¹ˆç”¨ï¼Ÿ

AST è¿ç”¨å¹¿æ³›ï¼Œæ¯”å¦‚ï¼š

- ç¼–è¾‘å™¨çš„é”™è¯¯æç¤ºã€ä»£ç æ ¼å¼åŒ–ã€ä»£ç é«˜äº®ã€è‡ªåŠ¨ä»£ç è¡¥å…¨ï¼›
- Elintã€Prettier å¯¹ä»£ç é”™è¯¯æˆ–è€…é£æ ¼çš„æ£€æŸ¥ï¼›
- webpack é€šè¿‡ babel è½¬ä¹‰ JavaScript ä»£ç ã€‚

å¹¶ä¸”å¦‚æœä½ æƒ³è¦äº†è§£ js çš„ç¼–è¯‘æ‰§è¡Œçš„åŸç†ï¼Œå°±å¿…é¡»å…ˆäº†è§£ ASTã€‚

### AST å¦‚ä½•ç”Ÿæˆï¼Ÿ

js æ‰§è¡Œçš„ç¬¬ä¸€æ­¥æ˜¯è¯»å– js æ–‡ä»¶ä¸­çš„å­—ç¬¦æµï¼Œç„¶åé€šè¿‡è¯æ³•åˆ†ææˆ Tokenï¼Œä¹‹åå†é€šè¿‡è¯­æ³•åˆ†æï¼ˆParserï¼‰ç”Ÿæˆ ASTï¼Œæœ€åç”Ÿæˆæœºå™¨ç å¹¶æ‰§è¡Œã€‚

ä¸»è¦è§£ææµç¨‹åˆ†ä¸ºä¸€ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼š

- åˆ†è¯ï¼šå°†æ•´ä¸ªä»£ç å­—ç¬¦ä¸²åˆ†å‰²æˆæœ€å°çš„è¯­æ³•å•å…ƒç»„ï¼›
- è¯­æ³•åˆ†æï¼šåœ¨åˆ†è¯çš„åŸºç¡€ä¸Šå»ºç«‹åˆ†æè¯­æ³•å•å…ƒä¹‹é—´çš„å…³ç³»ã€‚

JS Parser æ˜¯ JS è¯­æ³•è§£æå™¨ï¼Œä»–å¯ä»¥å°† JS æºç è½¬æˆ ASTï¼Œå¸¸è§çš„ Parser æœ‰ esprimaã€traceurã€acornã€shift ç­‰ã€‚

#### è¯æ³•åˆ†æ

è¯æ³•åˆ†æï¼Œä¹Ÿè¢«æˆä¸ºæ‰«æï¼ˆScannerï¼‰ï¼Œç®€å•æ¥è¯´å°±æ˜¯è°ƒç”¨ next()æ–¹æ³•ï¼Œä¸€ä¸ªä¸ªå­—æ¯æ¥è¯»å–å­—ç¬¦ï¼Œç„¶åä¸å®šä¹‰å¥½çš„ JavaScript å…³é”®å­—ç¬¦ä½œæ¯”è¾ƒï¼Œç„¶åç”Ÿæˆå¯¹åº”çš„ Tokenï¼ŒToken æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°å•å…ƒã€‚

ä¾‹å¦‚ var è¿™ä¸‰ä¸ªå­—ç¬¦ï¼Œå®ƒåªèƒ½ä½œä¸ºä¸€ä¸ªæ•´ä½“ï¼Œè¯­ä¹‰ä¸Šä¸èƒ½å†åˆ†è§£äº†ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ª Tokenã€‚

è¯æ³•åˆ†æå™¨é‡Œï¼Œæ¯ä¸€ä¸ªå…³é”®å­—ç¬¦æ˜¯ä¸€ä¸ª Tokenï¼Œæ¯ä¸€ä¸ªæ ‡è¯†ç¬¦æ˜¯ä¸€ä¸ª Tokenï¼Œæ¯ä¸€ä¸ªæ“ä½œç¬¦æ˜¯ä¸€ä¸ª Tokenï¼Œæ¯ä¸€ä¸ªæ ‡ç‚¹ç¬¦å·éƒ½æ˜¯ä¸€ä¸ª Tokenã€‚é™¤æ­¤ä¹‹å¤–è¿˜ä¼šè¿‡æ»¤æ‰æºç¨‹åºä¸­çš„æ³¨é‡Šå’Œç©ºç™½å­—ç¬¦ï¼ˆæ¢è¡Œç¬¦ã€ç©ºæ ¼ç¬¦ã€åˆ¶è¡¨ç¬¦ç­‰ï¼‰ã€‚æœ€ç»ˆï¼Œæ•´ä¸ªæºç¨‹åºéƒ½å°†è¢«åˆ†å‰²è¿›ä¸€ä¸ª Token åˆ—è¡¨ï¼ˆæˆ–è€…è¯´æ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼‰ã€‚

#### è¯­æ³•åˆ†æ

è¯­æ³•åˆ†æä¼šå°†è¯æ³•åˆ†æå‡ºæ¥çš„ Token è½¬åŒ–æˆæœ‰è¯­æ³•å«ä¹‰çš„æŠ½è±¡è¯­æ³•æ ‘ç»“æ„ã€‚åŒæ—¶éªŒè¯è¯­æ³•ï¼Œè‹¥è¯­æ³•é”™è¯¯ï¼Œåˆ™æŠ›å‡ºè¯­æ³•å¼‚å¸¸ã€‚

ä»¥ä¸‹æ˜¯ JavaScript ä»£ç ç‰‡æ®µåšçš„æ¼”ç¤º

```javascript
const fn = a => a;

- program {
  type: "program" // ç¨‹åº
  - body:[
    - VariableDeclaration{
      type: "VariableDeclaration" //  Var å£°æ˜
      - declarations: [ // å£°æ˜å˜é‡
        - VariableDeclarator {
          type: "VariableDeclarator"
          - id: Identifier {
            type: "Identifier"
            name: "fn"
          }
          - init: ArrowFunctionExpression {
            type: "ArrowFunctionExpression"
            id: null
            expression: true // expressionå±æ€§æŒ‡å‘ä¸€ä¸ªè¡¨è¾¾å¼èŠ‚ç‚¹å¯¹è±¡
            generator: false
            async: false
            - params: [
              - Identifier = $node {
                type: "Idengtifier"
                name: "a"
              }
            ]
            - body: Identifier {
                type: "Idengtifier"
                name: "a"
              }
          }
        }
      ]
      kind: "const"
    }
  ]
  sourceType: "module"
}
```

ä»è¿™ä¸ª AST è¯­æ³•æ ‘ä¸­æˆ‘ä»¬å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹å‡ºä¸€ä¸ªä»£ç å®ƒçš„å…·ä½“å«ä¹‰ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ˜¯ä»€ä¹ˆè¯­æ³•ï¼Œæ–¹æ³•ç­‰ã€‚

ä¸Šé¢è¿™æ®µæŒ‡çš„æ˜¯ï¼šç”¨ç±»å‹ const å£°æ˜å˜é‡ fn åªæƒ³ä¸€ä¸ªç®­å¤´å‡½æ•°è¡¨è¾¾å¼ï¼Œå®ƒçš„å‚æ•°æ˜¯ a å‡½æ•°ä½“ä¹Ÿæ˜¯ aã€‚
